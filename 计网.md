### 计网速成

#### `0X0a` 计算机网络体系结构

##### 一、计算机网络概述

```
1、协议
	组成:语法、语义、同步
2、各层的协议
	应用层:DNS、HTTP、SMTP
	传输层:TCP、UDP、ICMP
	网络层:IP协议、路由选择协议
3、服务和协议:在协议的控制下，某层中的两个对等的实体可以实现通信，并使得本层能够向上层提供服务。协议是水平的，服务是垂直的
4、从下到上：物理层、数据链路层、网络层、传输层、应用层
	传输层实现了为应用进程之间提供端到端的逻辑通信
	网络层实验异构网络的互联(IP)
	数据链路层使物理层更好的传输
```

```
1、计算机网络的基本分类方法主要有两种:
	网络所使用的传输技术(广播式和点对点式)
	覆盖返回和规模(广域网、局域网和城域网)
2、计算机网络最基本的功能:数据通信
	连接控制、传输控制、差错控制、流量控制、路由选择、多路复用
3、计算机网络的拓扑结构主要取决于它的通信子网
4、广域网的拓扑结构常采用网状
```

```
功能
物理层:在连接计算机的传输媒介上传输比特流
数据链路层:为网络层提供服务、链路管理、差错控制、帧界定、帧同步和透明传输、流量控制			帧
网络层:异构网络的互联、路由和转发													分组或数据报
传输层:提供端到端的逻辑通信、复用(不同的应用进程可以使用同一个传输层协议传送数据)和分用		报文段
会话层:会话管理和同步
表示层:数据的格式转换和压缩、加密解密
应用层:
```

#### `0X0b` 物理层

##### 一、物理层术语

```
1、解决的问题：如何在连接计算机的传输媒介上传输比特流
2、主要任务：确定传输媒体结构的一些特性
	机械特性
	功能特性:某条线上出现的某一电平的电压表示何种意义
	电气特性：规定电压范围、传输距离
	过程特性:各个物理线路的工作过程和时序关系
```

```
信道：信号传输的媒介
比特率：每秒传送的比特数，单位为bps
波特率：信号被调制之后在单位时间内的变化(一个码元携带n比特的信息，则M波特率的码元传输速率对应的信息传输速率为Mn比特/秒)
码元：用时间间隔相同的符号来表示一个二进制数字
```

##### 二、传输介质和设备

```
1、同步通信和异步通信
	同步通信：有公共时钟，使用帧作为单位
	异步通信：没有公共时钟，联络方式有不互锁、半互锁、全互锁，使用字节作为单位
2、传输介质
	双绞线(无屏蔽双绞线UTP，屏蔽双绞线STP 防止外部电磁干扰，成本高)，半双工
	同轴电缆：抗电磁干扰性能好；传速速率不够高，半双工
	光纤：通信容量大、距离传输远；脆弱易断、不易安装；多模光纤和单模光纤；支持全双工和半双工
3、物理层设备：
	中继器：将衰弱的数字信号再生，不是放大(放大器放大模拟信号)
	集线器：相当于是多端口的中继器
4、5-4-3规则：互联网串联的中继器的个数不能超过4个，串联的5段通信介质中只有3段可以挂接计算机
```

```
光纤系统的实际速率主要受限于光电转换的速率
计算机内部的数据传输是并行传输
```

##### 三、调制和编码

```
调制：把基带信号(数字信号)转化为模拟信号

曼彻斯特编码：电压由低到高跳动为0，电压由高到低跳动为1(自含时钟编码)
差分曼彻斯特编码：中间必跳变；边界有跳变为0，无跳变为1
```

##### 四、剩余内容

```
1、信道的极限容量
	奈奎斯特公式:C=2Wlog_2M
	C为传输速率(bps)，W是理想无噪声信道的带宽(Hz)，M为码元的种类数
	香农公式:C=Wlog_2(1+S/N)
	S/N为信噪比
	S/N用分贝作为度量单位时有：(S/N)_dB = 10log_10(S/N)
2、数据的传输方式
	电路交换:建立一条专有线路，数据直达；通信延时小、有序传输
	报文交换:以报文为单位，在节点间以存储转发的方法；无需建立连接；携带目标地址和源地址等信息；有一定时延，存储转发时间不固定，不能用于实时通信
	分组交换:拆分成若干组；无建立时延(但存在传输时延)，可能出现失序、丢失的情况
3、分组交换的实现方式
	数据报(属于分组交换)：每个分组在传输的时候都必须携带原地址和目的地址。按照目的主机的地址进行路由选择。
			无连接，每个数据报作为一个独立的单位进行传输，可能不按顺序到达
	虚电路：两个通信主机在通信之前会事先建立连接(逻辑上的连接)
		   依据虚电路号进行数据分组转发，可以确保分组传输速率、
		   传输有序可靠，但这条连接并不独占
```

```
1、根据采样定理，对于连续变化的模拟信号进行周期性采样，只要采样频率大于等于有效信号的最高频率或其带宽的2倍，则采样值便可以包含原始信号的全部信息
2、采样频率要大于等于有效信号最高频率的两倍
3、利用模拟通信信道传输数字信号的方法称为频带传输
4、在出错率很高的传输系统中，选用数据报方式；传输实验最小、保证数据无差错的传送，选用电路交换
```

<img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220526200626103.png" alt="image-20220526200626103" style="zoom:65%;" />

#### `0X0c` 数据链路层

##### 一、数据链路层基础和组帧

```
1、数据链路层的工作:把数据从一个结点可靠的传输到相邻的另一个结点
2、帧
	帧头SOH 00000001，帧尾EOT 00000100
	如果在内容里出现帧头或帧尾字符，用ESC转义
3、为了避免传输过程中帧丢失，采用计时器超时重发
```

##### 二、差错控制

```
通过提高信噪比可以减弱随机查错的影响
奇偶校验:奇校验只能检测1个数为偶数的数据
```

##### 三、流量控制和可靠传输机制

```
1、停止-等待流量控制:发送窗口大小1，接收窗口大小1
2、后退N帧协议:发送窗口>1，接收窗口1
	n比特对帧编号,1<= W <= 2^n-1
3、选择重传协议:发送窗口>1，接收窗口>1
	n比特对帧编号,1<= W <= 2^(n-1)，即窗口大小小于序号范围的一半
4、信道利用率
```

##### 四、介质访问控制MAC

```
1、信道划分MAC协议
	频分复用	ADSL(分为电话、上行、下行三个相对独立的信道)
	时分复用	适合传输数字信号(属于静态划分信道的方式，不会发生碰撞)
	波分复用
	码分复用
	多路复用器是结合两条或者多条的线路的传输
2、随机MAC协议
	ALOHA协议	先随机的直接发送，然后进行帧监听，发生碰撞则重新发送
			 规定时间段，在时间段开始的时候发送，然后侦听，发生碰撞后则在下一个时间段开始的时候以P概率重发
	CSMA协议	在发送之前先侦听是否空闲再做决定
	CSMA/CD协议:在侦听到空闲时边发送边检测碰撞，检测到碰撞后等待一个随机时间并重发
	CSMA/CA协议:将碰撞检测改变为碰撞避免
		802.11使用ARQ方案，即站点每通过无线局域网发送完一帧，就要收到对方的确认帧后才能继续发送下一帧
		所有站点发送完，必须再等待一段很短的时间才能发送下一帧，这段时间称为帧间间隔IFS。共有三种IFS:
			SIFS：最短的IFS
			PIFS：中等的IFS
			DIFS：最长的IFS
3、关于碰撞
	检测到碰撞的最大时间为2t，称之为争用期(以太网规定征用期的长度为51.2μs)
4、最小帧长
	帧长 > 2 * 传输时间 * 数据传输速率
	以太网规定的最短帧长为64B
5、受控接入MAC协议
	轮询访问技术(集中式控制)
	令牌传递技术(分散式控制)
```

<img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220525113248954.png" alt="image-20220525113248954" style="zoom: 80%;" />

##### 四、局域网LAN

```
1、数据链路层寻址与地址解析协议
	MAC地址:MAC地址长6字节
	ARP协议：根据本网内目的节点的IP地址获取MAC地址的过程，采取的是查询/响应方式
2、以太网
	IEEE802.3标准
	采用CSMA-CD访问控制协议
	以太网逻辑拓扑是总线形，物理拓扑是星形
3、几种以太网
	(1)传统以太网
		10Base-5	同轴电缆	10Mbps	最大距离500m
		10Base-T	双绞线		 10Mbps	最大距离100m
	(2)快速以太网
		100Base-FX	光纤		  100Mbps
	(3)千兆以太网和万兆以太网
4、交换机
	(1)转发和过滤:根据MAC地址有选择性的转发到目的端口
	(2)通过自学习的方式构建交换表
	(3)优点:无碰撞、支持不同链路的连接、方便网络管理
	以太网交换机本质上是一种多端口网桥
5、虚拟局域网VLAN
	逻辑上进行划分，分割的每一个字网是一个广播域
	可以抑制广播风暴
	
	第二层设备（网桥，交换机）第三层设备（路由器）都可以划分冲突域
	第三层设备（路由器）都可以划分广播域
```

##### 五、点对点链路协议

```
1、点对点协议(PPP)
	(1)身份验证
	(2)连接时协商IP地址
	(3)差错检测
	(4)支持多种上层协议
2、PPP组成
	组帧方法：将IP数据包封装到串行链路的方法，支持异步(传输的是字节)串行和同步(传输的是比特流)串行介质
	一个用来建立、配置和测试数据链路连接的链路控制协议LCP
	一套网络控制协议:NCP
3、PPP协议帧格式
	首部(F+A+C+协议，1+1+1+2字节)+信息部分(不超过1500字节)+尾部(FCS+F,2+1字节)
4、PPP字节填充
	出现0x7E,变为(0x7D,0x5E)两个相邻的字节
	出现0x7D,变为(0x7D,0x5D)
5、HDLC协议位填充
	5个1后面插入一个0
```

#### `0X0d` 网络层

##### 一、网络层的功能

```
1、网络层的主要目的是在任意节点间进行数据包传输(实现异构网络的互联)
2、路由器连接的异构网络是数据链路层和物理层的协议不同
3、IP、ICMP属于网络层协议(TCP属于传输层，FTP属于应用层)
```

##### 二、路由算法

```
1、链路状态路由算法中，使用dijkstra算法算法找到其他路径的路径长度
2、路由选择分为直接交付和间接交付。当发送站和目的站在同一个网段里，就使用直接交付
3、分层路由后，路由器只知道如何将分组路由到自己区域的目标地址
```

##### 三、`IPv4`

```
1、IPv4，首部长度、总长度、片偏移的基本单位是4B、1B、8B
2、数据报分片
	标志位有3位，最后两位有效
	DF=0数据报可以被分片；如果分组长度超过MTU而DF=1，则丢弃该分组，并用ICMP差错报文向源主机报告
	MF=0表示该数据报是原始数据报的最后一片
3、ARP协议
4、DHCP
	租用期
	采用UDP连接
5、ICMP：ICMP差错报文和ICMP询问报文
	ICMP报文封装在IP数据报中
	差错报文：终点不可达、时间超时、源点抑制(拥塞丢弃IP分组)、参数问题、重定向
	询问报文：回送请求和回答报文(PING)、时间戳请求和回答报文、地址掩码请求回答报文、路由器询问和通告报文
6、CIDR技术是把小的网络汇聚成大的超网
```

##### 四、`IPv6`

```
1、地址128位，首部长度8B的整数倍
2、IPv6不允许分片，减少了首部长度字段(首部长度固定)，没有校验和字段
```

##### 五、路由协议

```
1、内部网关协议IGP：OSPF、RIP
   外部网关协议EGP：BGP-4(边界网关协议)
2、RIP
	仅和相邻的路由器交换信息
	按照固定的时间间隔交换路由信息，例如每隔30s
	开销小，收敛速度快，但是网络故障会出现慢收敛的状态，使用UDP传输(应用层协议)
	交换内容为路由器知道的全部信息，即自己的路由表
3、OSPF
	洪泛法发送信息
	网络层协议，使用IP数据包传输
	交换的内容为与本路由器相邻的所有路由器的链路状态
4、BGP
	每个自治系统的管理员需要选择至少一个路由器作为该系统的"BGP发言人"。发言人之间交换路由信息需要建立TCP连接
	四种报文:OPEN、UPDATE、KEEPALIVE、NOTIFICATION
```

##### 六、`IP`组播

```
1、只应用于UDP，将报文同时送往多个接收者
2、IP组播使用D类地址，224.0.0.0~239.255.255.255，只有最后23位和以太网硬件地址一一对应
3、构造组播转发树避免环路
```

##### 七、网络层设备

```
1、路由器的路由选择部分包括三部分：路由选择处理机、路由选择协议、路由表
2、默认路由目的地址和子网掩码都是0.0.0.0
```

#### `0X0e` 传输层

##### 一、传输层基础

```
1、端口：
	熟知端口号0-1023，1024-49151为登记端口号
	FTP：21、Telnet：23、SMTP：25、DNS：53、HTTP：80、SNMP：161
2、套接字 Socket=(IP地址：端口号)
```

##### 二、`UDP`

```
1、UDP特点(在IP上添加了差错检测和复用分用)
	UDP无需建立连接，延迟短
	UDP实现简单，由于无连接，因此不需要维护连接的开销
	由于协议简单，因此UDP头部比较小(只有8B)，有效数据部分就可以更长
	没有拥塞控制，因此上层应用可以更加直接的掌控发送时间和速率
2、UDP常用的环境
	流媒体应用
	还可以用于DNS和SNMP
3、UDP段结构
	首部：源端口号、目的端口号、长度(包含头部)、校验和(均为2字节)
4、UDP校验和计算(首部和数据部分全部一起校验)
	发送方:`
        填上伪首部(仅在校验时出现):源IP、目的IP、0、17(协议字段，17代表UDP)、UDP长度(长度字节数分别为4、4、1、1、2)
        全0填充校验和字段，全0填充数据部分
        求和，此过程中遇到最高为进位进行回卷
        把求和取反码写入校验和字段
        去掉伪首部发送
	接收方:
	填上伪首部
	求和，此过程中遇到 最高位进位则回卷
	如果结果全1则保留，否则丢弃或者不丢弃，交给上层处理并附上差错报告
```

##### 三、TCP协议

```
1、特点(在IP上实现可靠的数据传输协议)
	面向连接；点对点连接，每条TCP连接只有两个端
	可靠交付、全双工通信、面向字节流
	有流量控制和拥塞机制
2、TCP报文段
	首部前20B是固定的，最短为20B，后面4N字节是根据需要增加(4B的倍数)
3、TCP三次握手
	客户机											服务器
			 		--SYN=1, seq=x-->
			<--SYN=1, ack=1, seq=y, ack=x+1--
				--ACK=1, seq=x+1, ack=y+1-->
4、TCP可靠传输
	序号：本报文发送的数据的第一个字节的序号
	确认：希望收到对方的下一个报文段的数据的第一个字节的序号
	重传
5、TCP流量控制
	接收方动态调整发送方的发送窗口大小，称为接收窗口rwnd
	拥塞窗口cwnd：发送端根据网络拥塞情况确定的窗口值
	其实发送窗口是cwnd和rwnd的最小值
```

```
1、TCP规定HTTP服务器进程的端口号是80
2、A和B建立了TCP连接，当A收到确认号为100的确认报文段时，表示末字节序号为99的报文段已收到(确认序号是希望收到对方的下一个报文段的数据的第一个字节的序号)
3、报文段丢失，就会重复发送确认上一个未收到的报文段第一个序号
4、TCP滑动窗口协议中，重传分组的数量不得超过滑动窗口的大小
5、UDP是面向报文的，而TCP是面向字节流的
	发送方 UDP 对应用程序交下来的报文，在添加首部后就向下交付 IP 层。UDP 对应用层交下来的报文，既不合并，也不拆分，而是保留这些报文的边界。接收方 UDP 对 IP 层交上来的 UDP 用户数据报，在去除首部后就原封不动地交付上层的应用进程，一次交付一个完整的报文。发送方TCP对应用程序交下来的报文数据块，视为无结构的字节流（无边界约束，课分拆/合并），但维持各字节。
6、发送方通过收到三个重复的确认，检测到丢失了报文段，下一个轮次的拥塞窗口减半。发送方通过超时，检测到丢失了报文段，下一个轮次的拥塞窗口下降到 1
```

#### `0X0f` 应用层

##### 一、网络应用模型

```
1、客户/服务模型(C/S)
	Web、FTP、远程登录和电子邮件等
	服务器程序不需要知道客户及程序的地址
2、P2P
	互联网中由对等节点组成的一种覆盖网络，是一种动态的逻辑网络
```

##### 二、DNS

```
1、授权域名服务器可以将其管辖的主机名转换为主机的IP地址
2、DNS可以使用传输层无连接服务
3、域名解析
	本地域名服务器、根域名服务器、顶级域名服务器、权限域名服务器
	递归查询、迭代查询
```

##### 三、FTP

```
1、FTP使用交互式的访问，允许客户指明文件的类型与格式，并允许文件有存取权限
2、采用C/s的工作方式，使用TCP传输
3、工作时服务端使用两个TCP连接，控制连接(21)和数据连接(20)
```

##### 四、电子邮件

```
1、邮件系统应该具备三个最主要的组成构建：用户代理(User Agent)、邮件服务器和邮件使用的协议(SMTP、POP3)
2、发送方用户代理使用SMTP协议向发送邮件服务器发送邮件
	发送邮件服务器使用SMTP协议向接收邮件服务器发送邮件
	接收方用户代理使用POP3从接收邮件服务器读取邮件
3、POP3协议在传输层使用明文传输密码
```



